---
title: "Step B1. Sampling Component and Variable Activation Report"
author: "Aidan Neher"
format: html
editor: visual
---

```{r}
#| include: false
library(tidyverse)
```

## About the simulated data

With `set.seed(1)`, data from BIP manuscript scenario 1 was simulated.

## Results from original `BIP()` vs. step B1

Defaults used for original `BIP()`: sample = 5000, burn-in = 1000

Note, we are only focused on the results for the first view (m=1) for now.

Here are the component selection MPPs using the original `BIP()` function:

```{r}
bip_0 <- readRDS("data/2023-07-03_simulation_BIP_results.rds")
bip_0$CompoSelMean[1, ]
```

Here are the component selection MPPs from one starting point:

```{r}
load("data/2023-08-26_image_1.RData")
get_CompoSelMean_m <- function(gamma_chain_m, n_burnin, n_iterations) {
  return ( gamma_chain[, (n_burnin+1):n_iterations] %>% rowMeans() )
}
get_CompoSelMean_m(gamma_chain, n_burnin, n_iterations)
```

These results indicate that the chain got stuck on a particular component.

Now, we look at the results from a different starting point:

```{r}
load("data/2023-08-26_image_2.RData")
get_CompoSelMean_m(gamma_chain, n_burnin, n_iterations)
```

Again, these results indicate that the chain got stuck on a particular component.

Here we look at the MPPs of 50 features (every 10th i.e. 1st, 11th, 21st, ...) in the component active in the MCMC:

```{r}
get_VarSelMean_m_l <- function(eta_chain_m, l, n_burnin, n_iterations) {
  return( eta_chain[l,,(n_burnin+1):n_iterations] %>% rowMeans() )
}
l <- 3 # TODO remove hardcoding
VarSelMean_m_l <- get_VarSelMean_m_l(eta_chain, l, n_burnin, n_iterations)
features_of_iterest <- seq(from = 1, to = p_m, by = 10)
VarSelMean_m_l[features_of_iterest]
```

There's no discrimination between important (the first 100 features) and unimportant (the last 400) features and the MPPs are close to 95%.

We contrast these results with those from the original `BIP()` function where important features of interest are selected around 10-15% of iterations and unimportant ones are selected generally < 1% of iterations.

```{r}
bip_0$VarSelMean[[m]][features_of_iterest,l]
```

## Run Time

The latest version of Step B1 required 16 hours. 