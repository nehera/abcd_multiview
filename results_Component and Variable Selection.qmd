---
title: "Component and Variable Selection Results"
author: "Aidan Neher"
date: "`r Sys.Date()`"
title-block-banner: "#FFCC33" 
title-block-banner-color: "#7A0019"
format: html
editor: visual
---

## Introduction to results

```{r}
#| echo: false
#| output: false
library(tidyverse)
seed <- 1
date <- "2023-08-03"
results_file_name <- paste0("data/", date, "_image_", seed, ".RData")
load(results_file_name)
```

The data visualized is from the most recent version of the MCMC for sampling component and variable selection indicators, gamma and eta respectively. To generate this data, the RNG seed was set at 1.

First, let's look at the MCMC's initial conditions:

```{r}
#| echo: false
str(initial_conditions)
```

## Is the code proposing gamma values stepwise (rather than blockwise) within an iteration?

Here we see that gamma's are being proposed with the desired stepwise machination.

```{r}
#| echo: false
print("Gamma accepted in first 3 iterations:")
gamma_chain[,1:3]
print("Gamma proposed in first 3 iterations:")
gamma_new_chain[,,1:3]
```

## Which components are getting selected for?

Below we observe that the chain is getting stuck with only the fourth component considered as active, even after a burn-in of 1,000 iterations.

```{r}
#| echo: false
print("Cumulative component selections:")
gamma_chain[, (n_burnin+1):n_iterations] %>% rowSums()
```

## How is the log target density calculation behaving?

Below we examine the log acceptance ratio from first 10 iterations.

From the initial conditions to the first iteration, we observe a large positive log acceptance ratio, which equates to a high probability of acceptance of the proposed gamma.

```{r}
log_target_chain[1] - initial_conditions$log_target
```

Aftwerwards, the log target density become quite negative and stays there, which is associated with an almost zero probability of acceptance. This is reflected in the chain getting stuck at 0001.

```{r}
#| echo: false
log_acceptance_ratio_plot <- t(log_acceptance_ratio_chain) %>% 
  as.data.frame() %>%
  mutate(iter = 1:n_iterations) %>%
  gather(key = "component", value = "log_acceptance_ratio", -iter) %>%
  ggplot(aes(x = iter, y = log_acceptance_ratio, color = component)) +
  geom_point()
log_acceptance_ratio_plot
```

This suggests either the chain hasn't run long enough or more likely that there's an issue in the evaluation of the log target densities.

## How are the variable selection indicators, eta, behaving?

Since only the fourth component is getting selected, we examine only its variable selection indicators. Note, for now, only 500 iterations are available and correspond to the last dimension.

```{r}
eta_chain[4, ,(n_burnin+1):n_iterations] %>% rowSums()
```

Because gamma and eta are selected/ rejected together, we notice that the collection of features selected is static i.e. each feature that has been selected once is selected for all available iterations.

## Does starting point impact the results?

Here we consider results from a different starting point (seed = 2), and notice the chain is still getting stuck with one active component:

```{r}
#| echo: false

seed <- 2
date <- "2023-08-03"
results_file_name <- paste0("data/", date, "_image_", seed, ".RData")
load(results_file_name)

print("Initial conditions:")
str(initial_conditions)
print("Gamma accepted in first 3 iterations:")
gamma_chain[,1:3]
print("Gamma proposed in first 3 iterations:")
gamma_new_chain[,,1:3]
print("Cumulative component selections:")
gamma_chain[, (n_burnin+1):n_iterations] %>% rowSums()
```

## Questions to consider

-   What are the MPPs (marginal posterior probabilities) of component and feature selection? Are the truly important components/ features getting selected?
-   Are the MPPs of component and feature selection converging?

## About Quarto

Quarto was used to generate this document, since it enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

Note, the following error on rendering is fine for the purposes of this document:

ERROR: No output created by quarto render results_Component and Variable Selection.qmd

Error: No output created by quarto render results_Component and Variable Selection.qmd at handleRenderResult (file:///Applications/quarto/bin/quarto.js:102402:15) at renderForPreview (file:///Applications/quarto/bin/quarto.js:102417:25) at async render (file:///Applications/quarto/bin/quarto.js:102303:20) at async preview (file:///Applications/quarto/bin/quarto.js:102309:21) at async Command.fn (file:///Applications/quarto/bin/quarto.js:103760:9) at async Command.execute (file:///Applications/quarto/bin/quarto.js:8437:13) at async quarto (file:///Applications/quarto/bin/quarto.js:127535:5) at async file:///Applications/quarto/bin/quarto.js:127553:9
